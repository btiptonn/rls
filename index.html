<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Residential Laundry System — Building</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f6f8fb; margin:0; }
    header { background:#2a6fb5; color:white; padding:16px; font-size:1.4em; }
    .container { padding:20px; }
    .floor-btn { display:block; background:#e5ecf7; padding:14px; margin:10px 0; border-radius:6px; text-decoration:none; color:#222; font-weight:bold; text-align:center; }
    .floor-btn.running { background:#c4f0c2; }
    .floor-btn.aborted { background:#f5b7b1; }
    .floor-btn.complete { background:#b3d8ff; }
    .floor-btn.idle { background:#e5ecf7; }
  </style>
</head>
<body>
  <header>Residential Laundry System — Building</header>

  <main class="container">
    <a id="washerBtn" class="floor-btn idle" href="washer.html">Floor 0 — Washer (1) — Idle</a>
    <p id="statusText">Waiting for Pico data...</p>
  </main>

  <script>
    const API_URL = "https://rls-uvzg.onrender.com/api/state";

    async function updateIndex() {
      const washerBtn = document.getElementById("washerBtn");
      const statusText = document.getElementById("statusText");

      try {
        const res = await fetch(API_URL, { cache: "no-store" });
        if (!res.ok) throw new Error("Bad response");
        const data = await res.json();

        const state = data.state || "Idle";
        washerBtn.textContent = `Floor 0 — Washer (1) — ${state}`;
        washerBtn.className = `floor-btn ${state.toLowerCase()}`;

        statusText.textContent =
          state === "Running"
            ? `Washer active (${data.time})`
            : state === "Aborted"
            ? "Washer aborted due to inactivity"
            : state === "Complete"
            ? "Washer finished cycle"
            : "Waiting for Pico data...";
      } catch (err) {
        washerBtn.className = "floor-btn idle";
        washerBtn.textContent = "Floor 0 — Washer (1) — Offline";
        statusText.textContent = "Server not reachable.";
      }
    }

    setInterval(updateIndex, 3000);
    updateIndex();
  </script>
</body>
</html>
